<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.webgis.mapper.TourMapper">

    <!--    几何查询点-->
    <select id="queryPoint" resultType="com.webgis.entity.table.ScenicEntity">
        select *
        from info
        WHERE x >= #{xmin}
          and y >= #{ymin}
          and x &lt;= #{xmax}
          and y &lt;= #{ymax}
    </select>

    <!--    景点查询所有信息-->
    <select id="queryAll" resultType="com.webgis.entity.table.ScenicEntity">
        select *
        from info
    </select>

    <!--    查询景点分数及评论个数-->
    <select id="coName" resultType="com.webgis.entity.table.CoScore">
        select *
        from coscore
        where name = #{name}
    </select>

    <!--    删除信息不对应的景点-->
    <delete id="deSC" parameterType="com.webgis.entity.table.ScenicEntity">
        delete
        from info
        where id = #{id}
    </delete>

    <!--    更新景点热度和分数-->
    <update id="upSH" parameterType="com.webgis.entity.table.ScenicEntity">
        update info
        set hot=#{hot},
            score=#{score}
        where id = #{id}
    </update>

    <!--查询景点个数-->
    <select id="coPC" resultType="com.webgis.entity.table.CoPC">
        select *
        from compc
        where name = #{name}
    </select>

    <!--更新评论省、市-->
    <update id="upPC" parameterType="com.webgis.entity.table.CoPC">
        update compc
        set province= #{sheng},
            city= #{shi}
        where name = #{name}
    </update>

    <!--获取评论城市列表-->
    <select id="cRank" resultType="map">
        select distinct city
        from comment
    </select>

    <select id="cCount" resultType="int">
        select count(*)
        from comment
        where city = #{city}
    </select>

    <insert id="inCC" parameterType="com.webgis.entity.table.CityRank">
        insert into cityrank(id, city, comcount)
        values (#{id}, #{city}, #{comcount})
    </insert>

    <select id="cScenicCount" resultType="com.webgis.entity.table.ScenicEntity">
        select name, score
        from info
        where city = #{city}
    </select>

    <select id="getcity" resultType="com.webgis.entity.table.CityRank">
        select city
        from cityrank
    </select>

    <update id="upCityScore" parameterType="com.webgis.entity.table.CityRank">
        update cityrank
        set sccount = #{sccount},
            scscore = #{scscore}
        where city = #{city}
    </update>

    <select id="cityRank" resultType="com.webgis.entity.table.CityRank">
        select *
        from cityrank
        order by hotrank limit 0,10
    </select>

    <select id="getPoint" resultType="com.webgis.entity.table.PointEntity">
        select *
        from point
    </select>


    <select id="get1000" resultType="com.webgis.entity.table.ScenicEntity">
        SELECT *
        FROM dbo.scenicInfo
        WHERE id = 488
    </select>

    <select id="getForm" resultType="com.webgis.entity.table.ScenicEntity">
        <if test="page==1">
            SELECT TOP(9)*
            FROM dbo.scenicInfo
            ORDER by id
        </if>
        <if test="page>1">
            SELECT top(9)*
            FROM dbo.scenicInfo
            WHERE id
            NOT IN (SELECT TOP(999)id
            FROM dbo.scenicInfo
            ORDER by id)
            ORDER by id
        </if>
    </select>

    <select id="searchForm" resultType="com.webgis.entity.table.ScenicEntity">
        <if test="page==1">
            SELECT TOP(#{count})*
            FROM dbo.scenicInfo
            WHERE Name LIKE CONCAT('%',#{model},'%')
            ORDER by id
        </if>
        <if test="page>1">
            SELECT top(#{count})*
            FROM dbo.scenicInfo
            WHERE Name LIKE CONCAT('%',#{model},'%')
            id NOT IN (SELECT TOP(#{jisuan})id FROM dbo.scenicInfo ORDER by id)
            ORDER by id
        </if>
    </select>


</mapper>
